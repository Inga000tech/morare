<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Morare â€” Daily Ritual</title>
<meta name="description" content="A daily one-page ritual built around real human courage. Stories, words, reflection, and a journal.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400;1,500&family=IM+Fell+English:ital@0;1&family=Crimson+Pro:ital,wght@0,300;0,400;1,300;1,400&display=swap" rel="stylesheet">
<style>
:root {
  --paper: #f5f0e8;
  --paper-mid: #ede5d0;
  --paper-shadow: #d4c9a8;
  --ink: #2c2416;
  --ink-light: #5a4e38;
  --ink-faint: #9a8d72;
  --accent: #7a3b1e;
  --accent-soft: #b85c38;
  --ruled: #d6cdb4;
  --gold: #8b6914;
  --spine-dark: #4a3728;
  --spine-mid: #7a6040;
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

html { scroll-behavior: smooth; }

body {
  min-height: 100vh;
  background: #b8ad94;
  background-image:
    radial-gradient(ellipse 80% 60% at 15% 40%, #a89878 0%, transparent 70%),
    radial-gradient(ellipse 60% 80% at 85% 70%, #ccc0a0 0%, transparent 60%);
  font-family: 'Lora', Georgia, serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2.5rem 1rem 5rem;
  position: relative;
}

/* Grain overlay */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 999;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BOOK WRAPPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.book-wrapper {
  position: relative;
  width: 100%;
  max-width: 740px;
  filter: drop-shadow(0 8px 40px rgba(0,0,0,0.35)) drop-shadow(0 2px 8px rgba(0,0,0,0.2));
}

/* Book spine */
.spine {
  position: absolute;
  left: -22px;
  top: 0;
  bottom: 0;
  width: 22px;
  background: linear-gradient(
    to right,
    var(--spine-dark) 0%,
    var(--spine-mid) 40%,
    #9a7a50 70%,
    var(--spine-mid) 100%
  );
  border-radius: 3px 0 0 3px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.spine-text {
  writing-mode: vertical-rl;
  text-orientation: mixed;
  transform: rotate(180deg);
  font-family: 'IM Fell English', serif;
  font-size: 9px;
  letter-spacing: 4px;
  color: #d4b870;
  text-transform: uppercase;
  opacity: 0.9;
  user-select: none;
}

/* Page stack effect */
.page-stack {
  position: absolute;
  right: -10px;
  top: 3px;
  bottom: 3px;
  width: 10px;
  background: repeating-linear-gradient(
    to right,
    #e8dfc8 0px, #e8dfc8 2px,
    #dfd4b5 2px, #dfd4b5 4px,
    #d8cdb0 4px, #d8cdb0 6px,
    #d4c9a8 6px, #d4c9a8 8px,
    #d0c4a0 8px, #d0c4a0 10px
  );
  border-radius: 0 2px 2px 0;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ JOURNAL PAPER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.journal {
  background: var(--paper);
  position: relative;
  overflow: hidden;
  border-radius: 0 2px 2px 0;
}

/* Horizontal ruled lines */
.journal::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image: repeating-linear-gradient(
    to bottom,
    transparent 0px,
    transparent 31px,
    var(--ruled) 31px,
    var(--ruled) 32px
  );
  background-position: 0 72px;
  pointer-events: none;
  opacity: 0.45;
  z-index: 0;
}

/* Red margin line */
.journal::after {
  content: '';
  position: absolute;
  top: 0; bottom: 0;
  left: 72px;
  width: 1px;
  background: linear-gradient(to bottom, transparent 0, #e8a090 8%, #e8a090 92%, transparent 100%);
  opacity: 0.35;
  pointer-events: none;
  z-index: 0;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ USER BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.user-bar {
  position: relative;
  z-index: 2;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 0.9rem;
  padding: 0.55rem 2.5rem 0.55rem 5.5rem;
  border-bottom: 1px solid var(--ruled);
  background: rgba(255,255,255,0.12);
}

.user-name {
  font-family: 'Crimson Pro', serif;
  font-size: 0.8rem;
  color: var(--ink-faint);
  letter-spacing: 0.5px;
}

.user-link {
  font-family: 'Crimson Pro', serif;
  font-size: 0.76rem;
  color: var(--accent);
  cursor: pointer;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  background: none;
  border: none;
  padding: 0;
  text-decoration: underline;
  text-decoration-style: dotted;
  text-underline-offset: 2px;
}
.user-link:hover { color: var(--accent-soft); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.header {
  position: relative;
  z-index: 2;
  padding: 2.2rem 2.5rem 1.4rem 5.5rem;
  border-bottom: 1px solid var(--ruled);
}

.date-line {
  font-family: 'Crimson Pro', serif;
  font-size: 0.75rem;
  color: var(--ink-faint);
  letter-spacing: 2.5px;
  text-transform: uppercase;
  margin-bottom: 0.35rem;
}

.brand {
  font-family: 'IM Fell English', serif;
  font-size: 2.6rem;
  color: var(--ink);
  letter-spacing: 1px;
  line-height: 1;
}
.brand em { font-style: italic; color: var(--accent); }

.tagline {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--ink-faint);
  font-size: 0.92rem;
  margin-top: 0.25rem;
  letter-spacing: 0.3px;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.nav-tabs {
  position: relative;
  z-index: 2;
  display: flex;
  padding: 0 2.5rem 0 5.5rem;
  border-bottom: 1px solid var(--ruled);
  background: rgba(255,255,255,0.08);
}

.nav-tab {
  padding: 0.65rem 1.3rem;
  font-family: 'Crimson Pro', serif;
  font-size: 0.8rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--ink-faint);
  cursor: pointer;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  transition: color 0.2s, border-color 0.2s;
  user-select: none;
}
.nav-tab:hover { color: var(--ink-light); }
.nav-tab.active { color: var(--accent); border-bottom-color: var(--accent); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page {
  display: none;
  position: relative;
  z-index: 2;
  padding: 2.5rem 2.5rem 3.5rem 5.5rem;
  min-height: 620px;
  animation: fadeUp 0.35s ease;
}
.page.active { display: block; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.loading-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 420px;
  gap: 1.4rem;
  color: var(--ink-faint);
}

.quill {
  font-size: 2.8rem;
  animation: quillBob 1.4s ease-in-out infinite;
  filter: grayscale(0.3);
}
@keyframes quillBob {
  0%, 100% { transform: rotate(-12deg) translateY(0px); }
  50%       { transform: rotate(6deg) translateY(-5px); }
}

.loading-text {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  font-size: 1rem;
  letter-spacing: 1px;
}

.loading-dots::after {
  content: '';
  animation: dots 1.5s steps(4, end) infinite;
}
@keyframes dots {
  0%  { content: ''; }
  25% { content: '.'; }
  50% { content: '..'; }
  75% { content: '...'; }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TODAY CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-label {
  font-family: 'Crimson Pro', serif;
  font-size: 0.7rem;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--ink-faint);
  margin-bottom: 0.7rem;
}

hr.divider {
  border: none;
  border-top: 1px solid var(--ruled);
  margin: 2rem 0;
}

/* Story */
.story-title {
  font-family: 'IM Fell English', serif;
  font-size: 1.55rem;
  color: var(--ink);
  line-height: 1.35;
  margin-bottom: 1rem;
  max-width: 580px;
}

.story-body {
  font-family: 'Lora', serif;
  font-size: 0.98rem;
  line-height: 1.88;
  color: var(--ink-light);
  max-width: 570px;
}
.story-body p { margin-bottom: 0.75rem; }

/* Word of Day */
.word-block {
  border: 1px solid var(--ruled);
  padding: 1.6rem 1.5rem;
  text-align: center;
  background: linear-gradient(160deg, rgba(139,105,20,0.05) 0%, rgba(122,59,30,0.03) 100%);
  position: relative;
  margin: 0 -0.5rem;
}
.word-block::before {
  content: 'âœ¦';
  position: absolute;
  top: -0.65rem;
  left: 50%;
  transform: translateX(-50%);
  background: var(--paper);
  padding: 0 0.6rem;
  color: var(--gold);
  font-size: 0.75rem;
}
.word-big {
  display: block;
  font-family: 'IM Fell English', serif;
  font-size: 3.4rem;
  color: var(--gold);
  letter-spacing: 3px;
  line-height: 1;
  margin-bottom: 0.35rem;
}
.word-theme-text {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--ink-faint);
  font-size: 0.9rem;
}

/* Quote */
.quote-block {
  padding: 0.4rem 0 0.4rem 1.8rem;
  border-left: 2px solid var(--accent-soft);
  max-width: 540px;
}
.quote-text {
  font-family: 'Lora', serif;
  font-style: italic;
  font-size: 1.05rem;
  line-height: 1.72;
  color: var(--ink);
}
.quote-attr {
  font-family: 'Crimson Pro', serif;
  font-size: 0.82rem;
  color: var(--ink-faint);
  margin-top: 0.5rem;
}

/* Reflection */
.reflection-box {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 1.25rem;
  color: var(--accent);
  line-height: 1.55;
  padding: 1.1rem 1.3rem;
  border: 1px dashed var(--paper-shadow);
  background: rgba(255,255,255,0.35);
  max-width: 570px;
}

.cta-row {
  display: flex;
  justify-content: center;
  padding-top: 0.5rem;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ WRITE PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.write-header {
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--ruled);
}
.write-date {
  font-family: 'Crimson Pro', serif;
  font-size: 0.78rem;
  color: var(--ink-faint);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 0.5rem;
}
.write-word-reminder {
  font-family: 'IM Fell English', serif;
  font-size: 1.15rem;
  color: var(--gold);
  margin-bottom: 0.3rem;
}
.write-q-reminder {
  font-family: 'Lora', serif;
  font-style: italic;
  font-size: 0.9rem;
  color: var(--ink-faint);
  line-height: 1.5;
}

.journal-textarea {
  width: 100%;
  min-height: 340px;
  background: transparent;
  border: none;
  outline: none;
  resize: none;
  font-family: 'Lora', serif;
  font-size: 1rem;
  line-height: 32px;
  color: var(--ink);
  caret-color: var(--accent);
  padding: 0;
}
.journal-textarea::placeholder {
  color: var(--ink-faint);
  font-style: italic;
  opacity: 0.65;
}

.word-count {
  font-family: 'Crimson Pro', serif;
  font-size: 0.76rem;
  color: var(--ink-faint);
  text-align: right;
  margin-top: 0.4rem;
  letter-spacing: 1px;
}

.action-row {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-top: 1.5rem;
  padding-top: 1.2rem;
  border-top: 1px solid var(--ruled);
  flex-wrap: wrap;
}
.save-note {
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  font-size: 0.8rem;
  color: var(--ink-faint);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  font-family: 'Crimson Pro', serif;
  font-size: 0.8rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 0.58rem 1.5rem;
  border: 1px solid var(--accent);
  background: transparent;
  color: var(--accent);
  cursor: pointer;
  transition: background 0.2s, color 0.2s;
  white-space: nowrap;
}
.btn:hover { background: var(--accent); color: var(--paper); }
.btn.primary { background: var(--accent); color: var(--paper); }
.btn.primary:hover { background: var(--accent-soft); border-color: var(--accent-soft); }
.btn.ghost { border-color: var(--paper-shadow); color: var(--ink-faint); }
.btn.ghost:hover { border-color: var(--ink-faint); color: var(--ink-light); background: transparent; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LIBRARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.entries-grid {
  display: flex;
  flex-direction: column;
  gap: 1.1rem;
}
.entry-card {
  border: 1px solid var(--ruled);
  padding: 1.1rem 1.4rem;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s;
  background: rgba(255,255,255,0.2);
  position: relative;
}
.entry-card:hover { background: rgba(255,255,255,0.55); border-color: var(--paper-shadow); }
.ec-date {
  font-family: 'Crimson Pro', serif;
  font-size: 0.74rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--ink-faint);
  margin-bottom: 0.25rem;
}
.ec-word {
  font-family: 'IM Fell English', serif;
  font-size: 1.2rem;
  color: var(--gold);
  margin-bottom: 0.3rem;
}
.ec-preview {
  font-family: 'Lora', serif;
  font-size: 0.88rem;
  color: var(--ink-light);
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.empty-msg {
  text-align: center;
  padding: 4rem 2rem;
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  color: var(--ink-faint);
  font-size: 1.05rem;
  line-height: 1.6;
}

/* Full entry view */
.full-entry { display: none; }
.full-entry.active { display: block; }
.back-btn {
  background: none; border: none;
  font-family: 'Crimson Pro', serif;
  font-size: 0.78rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--ink-faint);
  cursor: pointer;
  padding: 0 0 1.5rem 0;
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
}
.back-btn:hover { color: var(--accent); }
.full-entry-text {
  font-family: 'Lora', serif;
  font-size: 1rem;
  line-height: 32px;
  color: var(--ink-light);
  white-space: pre-wrap;
  max-width: 580px;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(44,36,22,0.72);
  z-index: 500;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  backdrop-filter: blur(2px);
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--paper);
  max-width: 420px;
  width: 100%;
  padding: 2.5rem 2.5rem 2rem;
  position: relative;
  box-shadow: 0 25px 80px rgba(0,0,0,0.45);
  animation: modalIn 0.3s ease;
}
@keyframes modalIn {
  from { opacity: 0; transform: translateY(-16px) scale(0.97); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}
.modal-close {
  position: absolute; top: 1rem; right: 1.2rem;
  background: none; border: none;
  font-size: 1.5rem; cursor: pointer; color: var(--ink-faint);
}
.modal-close:hover { color: var(--ink); }
.modal-title { font-family: 'IM Fell English', serif; font-size: 1.9rem; color: var(--ink); margin-bottom: 0.3rem; }
.modal-sub { font-family: 'Crimson Pro', serif; font-style: italic; color: var(--ink-faint); font-size: 0.9rem; margin-bottom: 1.6rem; }
.form-field { margin-bottom: 1rem; }
.form-label { display: block; font-family: 'Crimson Pro', serif; font-size: 0.72rem; letter-spacing: 2.5px; text-transform: uppercase; color: var(--ink-faint); margin-bottom: 0.3rem; }
.form-input { width: 100%; padding: 0.58rem 0.75rem; background: rgba(255,255,255,0.45); border: 1px solid var(--ruled); border-bottom-color: var(--paper-shadow); font-family: 'Lora', serif; font-size: 0.93rem; color: var(--ink); outline: none; transition: border-bottom-color 0.2s; }
.form-input:focus { border-bottom-color: var(--accent); }
.modal-toggle { font-family: 'Crimson Pro', serif; font-size: 0.85rem; color: var(--ink-faint); text-align: center; margin-top: 1rem; }
.modal-toggle a { color: var(--accent); cursor: pointer; text-decoration: underline; text-decoration-style: dotted; }
.form-error { font-family: 'Crimson Pro', serif; font-size: 0.83rem; color: #c0392b; margin-top: 0.4rem; display: none; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast {
  position: fixed;
  bottom: 2rem; left: 50%;
  transform: translateX(-50%) translateY(12px);
  background: var(--ink);
  color: var(--paper);
  font-family: 'Crimson Pro', serif;
  font-size: 0.88rem;
  letter-spacing: 1px;
  padding: 0.75rem 1.8rem;
  opacity: 0;
  transition: opacity 0.3s, transform 0.3s;
  z-index: 600;
  pointer-events: none;
  white-space: nowrap;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.footer {
  margin-top: 1.8rem;
  font-family: 'Crimson Pro', serif;
  font-style: italic;
  font-size: 0.8rem;
  color: #847562;
  letter-spacing: 1px;
  z-index: 1;
  text-align: center;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ERROR STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.error-state {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 420px;
  gap: 1rem;
  text-align: center;
}
.error-state.visible { display: flex; }
.error-icon { font-size: 2rem; opacity: 0.5; }
.error-msg { font-family: 'Crimson Pro', serif; font-style: italic; color: var(--ink-faint); font-size: 1rem; max-width: 320px; line-height: 1.5; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 580px) {
  body { padding: 1rem 0 3rem; }
  .spine { display: none; }
  .page-stack { display: none; }
  .header, .page { padding-left: 2.5rem; padding-right: 1.5rem; }
  .nav-tabs { padding-left: 2.5rem; }
  .user-bar { padding-left: 2.5rem; }
  .journal::after { left: 40px; }
  .word-big { font-size: 2.6rem; }
  .brand { font-size: 2rem; }
  .action-row { flex-direction: column; align-items: flex-start; }
}
</style>
</head>
<body>

<div class="book-wrapper">
  <div class="spine"><span class="spine-text">Morare Â· Daily Ritual</span></div>
  <div class="page-stack"></div>

  <div class="journal">

    <!-- User bar -->
    <div class="user-bar">
      <span class="user-name" id="userDisplay">guest â€” read only</span>
      <button class="user-link" id="authBtn" onclick="openAuth('signin')">Sign In</button>
    </div>

    <!-- Header -->
    <div class="header">
      <div class="date-line" id="dateDisplay"></div>
      <div class="brand">Mo<em>rare</em></div>
      <div class="tagline">A daily ritual built around real human courage</div>
    </div>

    <!-- Tabs -->
    <div class="nav-tabs">
      <button class="nav-tab active" data-tab="today" onclick="showTab('today')">Today</button>
      <button class="nav-tab" data-tab="write" onclick="showTab('write')">Write</button>
      <button class="nav-tab" data-tab="library" onclick="showTab('library')">Library</button>
    </div>

    <!-- â”€â”€ TODAY â”€â”€ -->
    <div class="page active" id="page-today">

      <div class="loading-state" id="loadingState">
        <div class="quill">âœ’ï¸</div>
        <div class="loading-text">Searching the archives<span class="loading-dots"></span></div>
      </div>

      <div class="error-state" id="errorState">
        <div class="error-icon">ğŸ“œ</div>
        <div class="error-msg" id="errorMsg">The archives are quiet today. Please try refreshing.</div>
        <button class="btn" onclick="loadDaily()">Try Again</button>
      </div>

      <div id="dailyContent" style="display:none">
        <div class="section-label">This Day in History</div>
        <div class="story-title" id="storyTitle"></div>
        <div class="story-body" id="storyBody"></div>

        <hr class="divider">

        <div class="section-label">Word of the Day</div>
        <div class="word-block">
          <span class="word-big" id="wordBig"></span>
          <div class="word-theme-text" id="wordTheme"></div>
        </div>

        <hr class="divider">

        <div class="section-label">A Voice Across Time</div>
        <div class="quote-block">
          <div class="quote-text" id="quoteText"></div>
          <div class="quote-attr" id="quoteAttr"></div>
        </div>

        <hr class="divider">

        <div class="section-label">Today's Question</div>
        <div class="reflection-box" id="reflectionQ"></div>

        <hr class="divider">

        <div class="cta-row">
          <button class="btn primary" onclick="showTab('write')">Open My Journal â†’</button>
        </div>
      </div>
    </div>

    <!-- â”€â”€ WRITE â”€â”€ -->
    <div class="page" id="page-write">
      <div class="write-header">
        <div class="write-date" id="writeDateDisplay"></div>
        <div class="write-word-reminder" id="writeWord">Loadingâ€¦</div>
        <div class="write-q-reminder" id="writeQuestion">â€”</div>
      </div>

      <textarea
        class="journal-textarea"
        id="journalText"
        placeholder="Begin here. There are no rulesâ€¦"
        oninput="onJournalInput()"
      ></textarea>
      <div class="word-count" id="wordCount">0 words</div>

      <div class="action-row">
        <button class="btn primary" onclick="handleSave()">Save Entry</button>
        <button class="btn ghost" onclick="exportEntry()">Export .txt</button>
        <span class="save-note" id="saveNote">Sign in to save permanently</span>
      </div>
    </div>

    <!-- â”€â”€ LIBRARY â”€â”€ -->
    <div class="page" id="page-library">

      <!-- Full entry view -->
      <div class="full-entry" id="fullEntryView">
        <button class="back-btn" onclick="closeFullEntry()">â† All Entries</button>
        <div class="write-date" id="feDate"></div>
        <div class="write-word-reminder" id="feWord"></div>
        <hr class="divider" style="margin: 1rem 0 1.5rem">
        <div class="full-entry-text" id="feText"></div>
        <div class="action-row" style="margin-top: 2rem">
          <button class="btn ghost" onclick="deleteEntry()">Delete This Entry</button>
        </div>
      </div>

      <!-- List view -->
      <div id="libraryList">
        <div class="section-label" style="margin-bottom:1.3rem">Your Entries</div>
        <div class="entries-grid" id="entriesGrid"></div>
      </div>

    </div>

  </div><!-- /journal -->
</div><!-- /book-wrapper -->

<div class="footer">Morare &middot; Every day, a new page</div>

<!-- Auth Modal -->
<div class="modal-overlay" id="authModal" onclick="handleModalOverlayClick(event)">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">Ã—</button>
    <div class="modal-title" id="modalTitle">Welcome Back</div>
    <div class="modal-sub" id="modalSub">Continue your daily ritual</div>

    <!-- Sign in -->
    <div id="formSignIn">
      <div class="form-field">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="siEmail" placeholder="you@example.com">
      </div>
      <div class="form-field">
        <label class="form-label">Password</label>
        <input class="form-input" type="password" id="siPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          onkeydown="if(event.key==='Enter') handleSignIn()">
      </div>
      <div class="form-error" id="siError">Incorrect email or password.</div>
      <br>
      <button class="btn primary" style="width:100%;padding:.7rem" onclick="handleSignIn()">Sign In</button>
      <div class="modal-toggle">No account? <a onclick="openAuth('signup')">Create one â€” it's free</a></div>
    </div>

    <!-- Sign up -->
    <div id="formSignUp" style="display:none">
      <div class="form-field">
        <label class="form-label">Your Name</label>
        <input class="form-input" type="text" id="suName" placeholder="First name is fine">
      </div>
      <div class="form-field">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="suEmail" placeholder="you@example.com">
      </div>
      <div class="form-field">
        <label class="form-label">Password</label>
        <input class="form-input" type="password" id="suPass" placeholder="6+ characters"
          onkeydown="if(event.key==='Enter') handleSignUp()">
      </div>
      <div class="form-error" id="suError"></div>
      <br>
      <button class="btn primary" style="width:100%;padding:.7rem" onclick="handleSignUp()">Create Account</button>
      <div class="modal-toggle">Already have one? <a onclick="openAuth('signin')">Sign in</a></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTANTS & STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ENTRIES_KEY  = 'morare_entries_v2';
const USER_KEY     = 'morare_user_v2';
const USERS_KEY    = 'morare_users_v2';
const DAILY_CACHE  = 'morare_daily_v2';

let todayData    = null;
let currentUser  = null;
let viewingEntry = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  setDateDisplays();
  restoreUser();
  loadDaily();
  restoreDraft();
  renderLibrary();
});

function setDateDisplays() {
  const d    = new Date();
  const full = d.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  document.getElementById('dateDisplay').textContent     = full;
  document.getElementById('writeDateDisplay').textContent = full;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TAB NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  document.querySelector(`[data-tab="${name}"]`).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DAILY CONTENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDaily() {
  const today = new Date();
  const cacheKey = `${DAILY_CACHE}_${today.getFullYear()}_${today.getMonth()}_${today.getDate()}`;
  const cached = localStorage.getItem(cacheKey);

  showLoading();

  if (cached) {
    try {
      todayData = JSON.parse(cached);
      renderDaily();
      return;
    } catch(e) { /* fall through */ }
  }

  try {
    const res = await fetch('/api/daily', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        month: today.toLocaleString('en-US', { month: 'long' }),
        day:   today.getDate(),
        year:  today.getFullYear(),
      }),
    });

    if (!res.ok) throw new Error(`HTTP ${res.status}`);

    todayData = await res.json();
    localStorage.setItem(cacheKey, JSON.stringify(todayData));
    renderDaily();
  } catch(err) {
    console.error('Daily load failed:', err);
    showError('The archives could not be reached. Check your connection and try again.');
  }
}

function showLoading() {
  document.getElementById('loadingState').style.display  = 'flex';
  document.getElementById('errorState').classList.remove('visible');
  document.getElementById('dailyContent').style.display  = 'none';
}

function showError(msg) {
  document.getElementById('loadingState').style.display = 'none';
  document.getElementById('errorMsg').textContent = msg;
  document.getElementById('errorState').classList.add('visible');
  document.getElementById('dailyContent').style.display = 'none';
}

function renderDaily() {
  document.getElementById('loadingState').style.display  = 'none';
  document.getElementById('errorState').classList.remove('visible');
  document.getElementById('dailyContent').style.display  = 'block';

  // Story
  document.getElementById('storyTitle').textContent = todayData.storyTitle || '';
  const bodyEl = document.getElementById('storyBody');
  bodyEl.innerHTML = '';
  (todayData.storyBody || '').split(/\n+/).filter(Boolean).forEach(p => {
    const el = document.createElement('p');
    el.textContent = p;
    bodyEl.appendChild(el);
  });

  // Word
  document.getElementById('wordBig').textContent   = todayData.word || '';
  document.getElementById('wordTheme').textContent = todayData.wordTheme || '';

  // Quote
  document.getElementById('quoteText').textContent = '\u201C' + (todayData.quoteText || '') + '\u201D';
  document.getElementById('quoteAttr').textContent = '\u2014 ' + (todayData.quoteAuthor || '');

  // Reflection
  document.getElementById('reflectionQ').textContent = todayData.reflectionQuestion || '';

  // Update write panel reminders
  document.getElementById('writeWord').textContent    = 'Word: ' + (todayData.word || 'â€”');
  document.getElementById('writeQuestion').textContent = todayData.reflectionQuestion || 'â€”';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JOURNAL / WRITE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onJournalInput() {
  const text  = document.getElementById('journalText').value;
  const words = text.trim() ? text.trim().split(/\s+/).length : 0;
  document.getElementById('wordCount').textContent = words + (words === 1 ? ' word' : ' words');
  localStorage.setItem('morare_draft', text);
}

function restoreDraft() {
  const d = localStorage.getItem('morare_draft');
  if (d) {
    document.getElementById('journalText').value = d;
    onJournalInput();
  }
}

function handleSave() {
  const text = document.getElementById('journalText').value.trim();
  if (!text) { toast('Write something firstâ€¦'); return; }
  if (!currentUser) { openAuth('signup', true); return; }
  commitSave(text);
}

function commitSave(text) {
  const today   = new Date();
  const dateKey = today.toISOString().split('T')[0];
  const dateStr = today.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

  const entries = getEntries();
  entries[dateKey] = {
    id: dateKey,
    date: dateStr,
    word: todayData?.word || 'â€”',
    question: todayData?.reflectionQuestion || '',
    text,
    savedAt: new Date().toISOString(),
  };
  setEntries(entries);

  localStorage.removeItem('morare_draft');
  document.getElementById('journalText').value = '';
  onJournalInput();
  renderLibrary();
  toast('Entry saved âœ¦');
}

function exportEntry() {
  const text = document.getElementById('journalText').value.trim();
  if (!text) { toast('Nothing to export yetâ€¦'); return; }

  const today    = new Date();
  const dateStr  = today.toLocaleDateString('en-US', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
  const word     = todayData?.word || '';
  const question = todayData?.reflectionQuestion || '';
  const line     = 'â”€'.repeat(44);

  const content = [
    'MORARE â€” Daily Journal',
    line,
    dateStr,
    word ? 'Word: ' + word : '',
    '',
    question,
    '',
    line,
    '',
    text,
  ].filter(l => l !== undefined).join('\n');

  const blob = new Blob([content], { type: 'text/plain' });
  const a    = document.createElement('a');
  a.href     = URL.createObjectURL(blob);
  a.download = `morare-${today.toISOString().split('T')[0]}.txt`;
  a.click();
  toast('Exported âœ¦');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LIBRARY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getEntries() {
  try { return JSON.parse(localStorage.getItem(ENTRIES_KEY) || '{}'); }
  catch(e) { return {}; }
}
function setEntries(e) { localStorage.setItem(ENTRIES_KEY, JSON.stringify(e)); }

function renderLibrary() {
  const entries = getEntries();
  const grid    = document.getElementById('entriesGrid');
  const sorted  = Object.values(entries).sort((a,b) => b.id.localeCompare(a.id));

  if (!sorted.length) {
    grid.innerHTML = '<div class="empty-msg">Your pages are blank.<br>Write your first entry today.</div>';
    return;
  }

  grid.innerHTML = sorted.map(e => `
    <div class="entry-card" onclick="openEntry(${JSON.stringify(e.id)})">
      <div class="ec-date">${e.date}</div>
      <div class="ec-word">${e.word}</div>
      <div class="ec-preview">${e.text.replace(/</g,'&lt;')}</div>
    </div>
  `).join('');
}

function openEntry(id) {
  const entries = getEntries();
  const e = entries[id];
  if (!e) return;
  viewingEntry = id;

  document.getElementById('feDate').textContent = e.date;
  document.getElementById('feWord').textContent = 'Word: ' + e.word;
  document.getElementById('feText').textContent = e.text;

  document.getElementById('libraryList').style.display = 'none';
  document.getElementById('fullEntryView').classList.add('active');
}

function closeFullEntry() {
  viewingEntry = null;
  document.getElementById('libraryList').style.display = 'block';
  document.getElementById('fullEntryView').classList.remove('active');
}

function deleteEntry() {
  if (!viewingEntry) return;
  if (!confirm('Delete this entry permanently?')) return;
  const entries = getEntries();
  delete entries[viewingEntry];
  setEntries(entries);
  closeFullEntry();
  renderLibrary();
  toast('Entry deleted');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH â€” localStorage demo
// (swap for Supabase later)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getUsers() {
  try { return JSON.parse(localStorage.getItem(USERS_KEY) || '{}'); }
  catch(e) { return {}; }
}
function setUsers(u) { localStorage.setItem(USERS_KEY, JSON.stringify(u)); }

function restoreUser() {
  try {
    const u = JSON.parse(localStorage.getItem(USER_KEY));
    if (u?.email) applyUser(u);
  } catch(e) {}
}

function applyUser(user) {
  currentUser = user;
  if (user) {
    document.getElementById('userDisplay').textContent   = user.name || user.email;
    document.getElementById('authBtn').textContent       = 'Sign Out';
    document.getElementById('authBtn').onclick           = signOut;
    document.getElementById('saveNote').textContent      = 'Entries saved to your library';
  } else {
    document.getElementById('userDisplay').textContent   = 'guest â€” read only';
    document.getElementById('authBtn').textContent       = 'Sign In';
    document.getElementById('authBtn').onclick           = () => openAuth('signin');
    document.getElementById('saveNote').textContent      = 'Sign in to save permanently';
  }
}

let _pendingSave = false;

function openAuth(mode, afterSave = false) {
  _pendingSave = afterSave;
  document.getElementById('authModal').classList.add('open');
  document.getElementById('siError').style.display = 'none';
  document.getElementById('suError').style.display = 'none';

  if (mode === 'signin') {
    document.getElementById('modalTitle').textContent = 'Welcome Back';
    document.getElementById('modalSub').textContent   = afterSave ? 'Sign in to save your entry' : 'Continue your ritual';
    document.getElementById('formSignIn').style.display = 'block';
    document.getElementById('formSignUp').style.display = 'none';
  } else {
    document.getElementById('modalTitle').textContent = 'Begin Your Journal';
    document.getElementById('modalSub').textContent   = afterSave ? 'Create a free account to save' : 'Free, always';
    document.getElementById('formSignIn').style.display = 'none';
    document.getElementById('formSignUp').style.display = 'block';
  }
}

function closeModal() {
  document.getElementById('authModal').classList.remove('open');
}
function handleModalOverlayClick(e) {
  if (e.target === document.getElementById('authModal')) closeModal();
}

function handleSignIn() {
  const email = document.getElementById('siEmail').value.trim().toLowerCase();
  const pass  = document.getElementById('siPass').value;
  const users = getUsers();
  const errEl = document.getElementById('siError');

  if (!users[email] || users[email].password !== pass) {
    errEl.style.display = 'block'; return;
  }

  errEl.style.display = 'none';
  const user = { email, name: users[email].name };
  localStorage.setItem(USER_KEY, JSON.stringify(user));
  applyUser(user);
  closeModal();
  toast('Welcome back, ' + user.name + ' âœ¦');
  if (_pendingSave) { _pendingSave = false; commitSave(document.getElementById('journalText').value.trim()); }
}

function handleSignUp() {
  const name  = document.getElementById('suName').value.trim();
  const email = document.getElementById('suEmail').value.trim().toLowerCase();
  const pass  = document.getElementById('suPass').value;
  const errEl = document.getElementById('suError');

  if (!name)               { errEl.textContent = 'Please enter your name.'; errEl.style.display = 'block'; return; }
  if (!email.includes('@')){ errEl.textContent = 'A valid email is required.'; errEl.style.display = 'block'; return; }
  if (pass.length < 6)     { errEl.textContent = 'Password must be 6+ characters.'; errEl.style.display = 'block'; return; }

  const users = getUsers();
  if (users[email]) { errEl.textContent = 'That email is already registered.'; errEl.style.display = 'block'; return; }

  users[email] = { name, password: pass };
  setUsers(users);

  const user = { email, name };
  localStorage.setItem(USER_KEY, JSON.stringify(user));
  applyUser(user);
  closeModal();
  toast('Welcome to Morare, ' + name + ' âœ¦');
  if (_pendingSave) {
    _pendingSave = false;
    const draft = document.getElementById('journalText').value.trim() || localStorage.getItem('morare_draft') || '';
    if (draft) commitSave(draft);
  }
}

function signOut() {
  currentUser = null;
  localStorage.removeItem(USER_KEY);
  applyUser(null);
  toast('Signed out');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _toastTimer;
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(() => el.classList.remove('show'), 2800);
}
</script>
</body>
</html>
